import { LinkOut } from '@interledger/docs-design-system'
import HttpSig from '/src/partials/http-msg-sig-note.mdx'
import ChunkedSnippet from '/src/components/ChunkedSnippet.astro'

<details>
<summary>Prerequisites</summary>

- Node 20
- A package manager such as NPM or PNPM
- <LinkOut href='https://www.npmjs.com/package/@interledger/open-payments'>
    Open Payments SDK
  </LinkOut>
- <LinkOut href='https://www.npmjs.com/package/tsx'>TSX</LinkOut>

**Additional configuration**

Add `"type": "module"` to `package.json`

Add the following to `tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022"
  }
}
```

<HttpSig />
</details>

<details> 
<summary>Import client from Open Payments SDK</summary>

Import `createAuthenticatedClient` from the Open Payments SDK package.

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/incoming-payment/incoming-payment-create.ts'
  chunk='1'
/>

</details>

<details> 
<summary>Create an authenticated Open Payments client</summary>

Create an Open Payments-authenticated client by providing the following properties:

- `walletAddressURL` : the Open Payments-enabled wallet address of your marketplace platform that your client will use to authenticate itself to one or more Authorization Servers (AS).
- `privateKey` : the EdDSA-Ed25519 key or preferably the absolute or relative file path to the key that is bound to your wallet address. A public key signed with this private
  key must be made available as a public JWK document at `{walletAddressUrl}/jwks.json` url.
- `keyId` : the identifier of the private key and the corresponding public key.

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-outgoing-payment.ts'
  chunk='2'
/>
</details>

<details> 
<summary>Get WalletAddresses</summary>

Fetch wallet addresses of the buyer, merchant and your marketplace platform.

```ts
const merchantWalletAddress = await client.walletAddress.get({
  url: 'https://ASEabc.com/merchant'
})

const customerWalletAddress = await client.walletAddress.get({
  url: 'https://ASExyz.com/alice'
})

const platformWalletAddress = await client.walletAddress.get({
  url: 'https://ASEdef.com/platform'
})
```

</details>

---
title: Create an outgoing payment grant request
tableOfContents:
  maxHeadingLevel: 2
---

import { CodeBlock, LinkOut, Tooltip } from '@interledger/docs-design-system'
import { Tabs, TabItem, LinkButton } from '@astrojs/starlight/components'
import ChunkedSnippet from '/src/components/ChunkedSnippet.astro'
import Begin from '/src/partials/before-you-begin.mdx'
import Ts from '/src/partials/ts-init-config.mdx'
import TsImport from '/src/partials/ts-import-initialize.mdx'
import PhpImport from '/src/partials/php-import-initialize.mdx'

Before a client can call most of the Open Payments APIs, it must receive a grant from the appropriate authorization server.

The snippets below enable a client to request a grant for an outgoing payment. The request to the authorization server must indicate the `outgoing-payment` access type and the actions the client wants to take at the resource server.

## Before you begin

<Begin />

## Request an outgoing payment grant

In Open Payments, outgoing payments require explicit consent, usually by the client's user, before a grant can be issued. Consent is obtained through an interactive grant.

Open Payments also requires any authorization server that issues interactive grants to integrate with an [identity provider (IdP)](/identity/idp). When the client requests the outgoing payment grant, the authorization server provides the client with the IdP URI the client should redirect to.

<Tabs syncKey="langs">
<TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
<LinkButton href="https://github.com/interledger/open-payments-snippets/blob/main/README.md#prerequisites" target="_blank" icon="external" iconPlacement="start">Prerequisites</LinkButton>

<details>
  <summary>Initial configuration</summary>
  <Ts />
</details>

<TsImport />

<ChunkedSnippet source="grant/grant-outgoing-payment.ts" l="node" chunk="3" />

#### Generate without an interval

<ChunkedSnippet source="grant/grant-outgoing-payment.ts" l="node" chunk="4" />

#### Generate with an interval

<ChunkedSnippet
  source="grant/grant-outgoing-payment-interval.ts"
  l="node"
  chunk="4"
/>

<ChunkedSnippet source="grant/grant-outgoing-payment.ts" l="node" chunk="5" />

<ChunkedSnippet source="grant/grant-outgoing-payment.ts" l="node" chunk="6" />

For TypeScript, run `tsx path/to/directory/index.ts`. <LinkOut href='https://github.com/interledger/open-payments/blob/main/snippets/node/grant/grant-outgoing-payment.ts'>View full TS source</LinkOut>

For JavaScript, run `node path/to/directory/index.js`. <LinkOut href='https://github.com/interledger/open-payments/blob/main/snippets/node/grant/grant-outgoing-payment.js'>View full JS source</LinkOut>

</TabItem>
<TabItem label="Rust" icon='seti:rust'>
<LinkButton href="https://github.com/interledger/open-payments-rust/tree/main/src/snippets#readme" target="_blank" icon="external" iconPlacement="start">Prerequisites</LinkButton>

<ChunkedSnippet source="grant/grant-outgoing-payment.rs" l="rust" chunk="1" />

<ChunkedSnippet source="grant/grant-outgoing-payment.rs" l="rust" chunk="2" />

<ChunkedSnippet source="grant/grant-outgoing-payment.rs" l="rust" chunk="3" />

<ChunkedSnippet source="grant/grant-outgoing-payment.rs" l="rust" chunk="4" />

<ChunkedSnippet source="grant/grant-outgoing-payment.rs" l="rust" chunk="5" />

<p>
  <LinkOut href="https://github.com/interledger/open-payments/blob/main/snippets/rust/grant/grant-outgoing-payment.rs">
    View full Rust source
  </LinkOut>
</p>

</TabItem>
<TabItem label="PHP" icon='seti:php'>
<LinkButton href="https://github.com/interledger/open-payments-php-snippets/blob/main/README.md#prerequisites" target="_blank" icon="external" iconPlacement="start">Prerequisites</LinkButton>

<PhpImport />

<ChunkedSnippet
  source="https://raw.githubusercontent.com/interledger/open-payments-php-snippets/refs/heads/main/src/Command/Grant/GrantOutgoingPayment.php"
  chunk="3"
/>

#### Generate without an interval

<ChunkedSnippet
  source="https://raw.githubusercontent.com/interledger/open-payments-php-snippets/refs/heads/main/src/Command/Grant/GrantOutgoingPayment.php"
  chunk="4"
/>

#### Generate with an interval

<ChunkedSnippet
  source="https://raw.githubusercontent.com/interledger/open-payments-php-snippets/refs/heads/main/src/Command/Grant/GrantOutgoingPaymentInterval.php"
  chunk="4"
/>

<ChunkedSnippet
  source="https://raw.githubusercontent.com/interledger/open-payments-php-snippets/refs/heads/main/src/Command/Grant/GrantOutgoingPayment.php"
  chunk="5"
/>
<ChunkedSnippet
  source="https://raw.githubusercontent.com/interledger/open-payments-php-snippets/refs/heads/main/src/Command/Grant/GrantOutgoingPayment.php"
  chunk="6"
/>

<p><LinkOut href='https://github.com/interledger/open-payments-php-snippets/blob/main/src/Command/Grant/GrantOutgoingPayment.php'>View full source without interval</LinkOut></p>
<p><LinkOut href='https://github.com/interledger/open-payments-php-snippets/blob/main/src/Command/Grant/GrantOutgoingPaymentInterval.php'>View full source with interval</LinkOut></p>
</TabItem>
<TabItem label="Go" icon='seti:go'>
<LinkButton href="https://github.com/interledger/open-payments-go/blob/main/README.md" target="_blank" icon="external" iconPlacement="start">Prerequisites</LinkButton>

```go
package main

import (
	"context"
	"encoding/json"
	"fmt"
	"log"

	op "github.com/interledger/open-payments-go"
	as "github.com/interledger/open-payments-go/generated/authserver"
)

func main() {
	// Initialize Open Payments client
	client, err := op.NewAuthenticatedClient(WALLET_ADDRESS_URL, PRIVATE_KEY_BASE_64, KEY_ID)
	if err != nil {
		log.Fatalf("Error creating authenticated client: %v\n", err)
	}

	// Get wallet address information
	walletAddress, err := client.WalletAddress.Get(context.TODO(), op.WalletAddressGetParams{
		URL: WALLET_ADDRESS_URL,
	})
	if err != nil {
		log.Fatalf("Error fetching wallet address: %v\n", err)
	}

	// Request outgoing payment grant
	outgoingAccess := as.AccessOutgoing{
		Type: as.OutgoingPayment,
		Actions: []as.AccessOutgoingActions{
			as.AccessOutgoingActionsCreate,
			as.AccessOutgoingActionsRead,
			as.AccessOutgoingActionsList,
		},
		Identifier: *walletAddress.Id,
	}
	accessItem := as.AccessItem{}
	if err := accessItem.FromAccessOutgoing(outgoingAccess); err != nil {
		log.Fatalf("Error creating AccessItem: %v\n", err)
	}
	accessToken := struct {
		Access as.Access `json:"access"`
	}{
		Access: []as.AccessItem{accessItem},
	}
	interact := &as.InteractRequest{
		Start: []as.InteractRequestStart{as.InteractRequestStartRedirect},
	}

	grant, err := client.Grant.Request(context.TODO(), op.GrantRequestParams{
		URL: *walletAddress.AuthServer,
		RequestBody: as.GrantRequestWithAccessToken{
			AccessToken: accessToken,
			Interact:    interact,
		},
	})
	if err != nil {
		log.Fatalf("Error requesting grant: %v\n", err)
	}

	// Check grant state (interaction is required for outgoing payments)
	if !grant.IsInteractive() {
		log.Fatalf("Expected interactive grant")
	}

	// Output
	grantJSON, err := json.MarshalIndent(grant, "", "  ")
	if err != nil {
		log.Fatalf("Error marshaling grant: %v\n", err)
	}
	fmt.Println("GRANT:", string(grantJSON))
	fmt.Println("Please interact at the following URL:", grant.Interact.Redirect)
	fmt.Println("CONTINUE_ACCESS_TOKEN =", grant.Continue.AccessToken.Value)
	fmt.Println("CONTINUE_URI =", grant.Continue.Uri)
}
```

</TabItem>
<TabItem label='Java' icon='seti:java'>
    <LinkButton
      href="https://github.com/interledger/open-payments-java?tab=readme-ov-file#prerequisites" target="_blank" icon="external" iconPlacement="start">Prerequisites</LinkButton>

    ```java wrap
    // 1. Import:
    import org.interledger.openpayments.httpclient.OpenPaymentsHttpClient;
    import org.interledger.openpayments.IOpenPaymentsClient;

    // 2. Client instance using HTTP:
    var client = OpenPaymentsHttpClient.defaultClient(
    "WalletAddress",
    "PrivateKeyPEM",
    "KeyId"
    );

    // 3. Retrieve the wallets:
    var senderWallet = client.getWalletAddress("https://cloudninebank.example.com/customer");
    var receiverWallet = client.getWalletAddress("https://cloudninebank.example.com/merchant");

    // 4. Create incoming payment:
    var grantRequest = this.client.createGrantIncomingPayment(receiverWallet);
    var incomingPayment = this.client.createIncomingPayment(receiverWallet, grantRequest, BigDecimal.valueOf(11.25));

    // 5. Create quote:
    var quoteRequest = this.client.createGrantQuote(senderWallet);
    var quote = this.client.createQuote(quoteRequest.getAccess().getToken(), senderWallet, incomingPayment);

    var urlToOpen = "http://localhost:%d?paymentId=1234".formatted(port);

    // 6. Create outing payment from quote:
    var opContinueInteract = this.client.createGrantContinuation(
    senderWallet,
    quote.getDebitAmount(),
    URI.create(urlToOpen),
    "test"
    );

    // 7. Logging:
    log.info("OUTGOING_PAYMENT_GRANT: {}", opContinueInteract);
    ```

</TabItem>
</Tabs>

## References

- [API specification](/apis/auth-server/operations/post-request)
- [Grant negotiation and authorization](/identity/grants)

---
title: Get an outgoing payment grant without recipients
---

import { CodeBlock, LinkOut } from '@interledger/docs-design-system'
import { Tabs, TabItem } from '@astrojs/starlight/components'
import HttpSig from '/src/partials/http-msg-sig-note.mdx'
import ChunkedSnippet from '/src/components/ChunkedSnippet.astro'
import TsImport from '/src/partials/ts-import-initialize.mdx'
import PhpImport from '/src/partials/php-import-initialize.mdx'
import InteractionReq from '/src/partials/interaction-required.mdx'
import StartInteraction from '/src/partials/grant-start-interaction.mdx'
import FinishInteraction from '/src/partials/grant-finish-interaction.mdx'

:::tip[Summary]
Learn how to get an outgoing payment grant for future payments without specifying any recipients.
:::

A typical Open Payments transaction begins with the client getting the recipient’s information and requesting an incoming payment grant from the recipient’s ASE. However, Open Payments also allows a client to request an outgoing payment grant from the sender’s ASE before knowing the intended recipient(s). This is seen in Web Monetization’s pay-as-you-browse model.

In this model, a user installs a browser extension and visits a web monetized site. The extension uses Open Payments to issue continuous outgoing payments to the site, on behalf of the user, for as long as the user is on the site. But, the extension has no idea who the recipient is until the user visits the site.

Setting up the extension requires the user to connect it to their wallet account. They specify a maximum amount they're willing to spend and select whether the amount should renew monthly. The extension then receives an outgoing payment grant from the user’s wallet provider, allowing the extension to initiate future payments.

In this guide, you’ll assume the role of an app developer. The guide takes you through the steps your app will perform when requesting an outgoing payment grant without known recipients. The example scenario illustrates how to allow your app’s user to send payments of up to $100 CAD a month for three months.

## Dependencies

- <LinkOut href='https://github.com/interledger/open-payments/tree/main/packages/open-payments'>
    Open Payments SDK
  </LinkOut>

<HttpSig />

## Endpoints

- <LinkOut href='https://openpayments.dev/apis/auth-server/operations/post-request/'>
    Grant Request
  </LinkOut>
- <LinkOut href='https://openpayments.dev/apis/auth-server/operations/post-continue/'>
    Continue Grant Request
  </LinkOut>

## Steps

### 1. Import dependencies and initialize the client

<Tabs syncKey='lang'>
  <TabItem label='TypeScript/JavaScript'>
    <TsImport />
  </TabItem>
  <TabItem label='PHP'>
    <PhpImport />
  </TabItem>
</Tabs>

### 2. Get user's wallet address information

Let’s assume your user saved their wallet address in their account profile when setting up your app. Use this address to get the authorization server address, resource server address, and other details about your user’s wallet.

You should perform this step every time you request a grant in case something changes on your user’s side.

<Tabs syncKey="lang">
<TabItem label='TypeScript/JavaScript'>
```ts
const walletAddress = await client.walletAddress.get({
  url: 'https://cloudninebank.example.com/user'
})
```
</TabItem>
<TabItem label='PHP'>
```php
$wallet = $opClient->walletAddress()->get([
      'url' => "https://cloudninebank.example.com/user"
]);
```
</TabItem>
</Tabs>

### 3. Request an interactive outgoing payment grant

Your user indicates they want to make payments of up to $100 CAD a month for three months. The amount resets each month and any unspent portions don't roll over.

Begin by requesting an interactive outgoing payment grant from the authorization server URL returned in the previous step.

<InteractionReq />

#### Request requirements

The request must include:

- `debitAmount` - The maximum amount that your user can send per interval. When the next interval begins, the value resets.
- `interval` - The recurring time [interval](#about-the-interval) under which this grant is valid. Must be expressed in <LinkOut href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</LinkOut> format which is a standardized way to express time-related information.
- `interact` object with a `finish` URI - The URI your user will be automatically sent to when interaction, described in the next steps, is complete.

<Tabs syncKey="lang">
<TabItem label='TypeScript/JavaScript'>
```ts
const grant = await client.grant.request(
  {
    url: walletAddress.authServer,
  },
  {
    access_token: {
      access: [
        {
          identifier: walletAddress.id,
          type: 'outgoing-payment',
          actions: ['read', 'create'],
          limits: {
            interval: 'R3/2025-05-20T13:00:00Z/P1M'
            debitAmount: {
              assetCode: 'CAD',
              assetScale: 2,
              value: '10000',
            },
          },
        },
      ],
    },
    client: clientWalletAddress.id,
    interact: {
      start: ['redirect'],
      finish: {
        method: 'redirect',
        uri: 'https://cloudninebank.example.com/finish/T8jw5Xy',
        nonce: NONCE,
      },
    },
  },
);
```
</TabItem>
<TabItem label='PHP'>
```php
$grant = $opClient->grant()->request(
  [
    url => $wallet->authServer,
  ],
  [
    access_token => [
      access => [
        [
          type => "outgoing-payment",
          actions => ["read", "create"],
          identifier => $wallet->id,
          limits => [
            debitAmount => [
              assetCode => "CAD",
              assetScale => 2,
              value => "10000",
            ],
            interval => "R/2025-04-22T08:00:00Z/P1D",
          ],
        ],
      ],
    ],
    client => $config->getWalletAddressUrl(),
    interact => [
      start => ["redirect"],
      finish => [
        method => "redirect",
        uri => "https://cloudninebank.example.com/finish/T8jw5Xy",
        nonce => "NONCE",
      ],
    ],
  ]
);
```
</TabItem>
</Tabs>

#### About the interval

The interval used in this guide is `R3/2025-05-20T13:00:00Z/P1M`. Remember that your user wants to send payments up to $100 CAD a month for three months. The interval breaks down like this:

- `R[3]/` is the number of repetitions - three.
- `2025-05-20` is the start date of the repeating interval - 20 May 2025
- `T13:00:00Z/` is the start time of the repeating interval - 1:00 PM UTC.
- `[P1M]` is the period of time between each interval - one month. Used with `R[3]`, you have a grant that’s valid once a month for three months.

Altogether, your user can send up to $100 CAD from:

- 1 PM UTC on 20 May 2025 through 12:59 PM UCT on 20 June 2025
- 1 PM UTC on 20 June 2025 through 12:59 PM UTC on 20 July 2025
- 1 PM UTC on 20 July 2025 through 12:59 PM UCT on 20 August 2025

### 4. Start interaction with the user

<StartInteraction />

### 5. Finish interaction with the user

<FinishInteraction />

### 6. Request a grant continuation

Use the interaction reference (`interact_ref`) returned in the previous step to continue the grant request.

<Tabs syncKey='lang'>
  <TabItem label='TypeScript/JavaScript'>
    <ChunkedSnippet
      source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-continuation.ts'
      chunk='3'
    />
  </TabItem>
  <TabItem label='PHP'>
    <ChunkedSnippet
      source='https://raw.githubusercontent.com/interledger/open-payments-php-snippets/refs/heads/main/src/Command/Grant/GrantContinuation.php'
      chunk='3'
    />
  </TabItem>
</Tabs>

A successful response provides your app with an access token. You'll need to ensure future outgoing payment requests reference this token.

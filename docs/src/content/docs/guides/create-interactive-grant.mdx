---
title: Create an interactive grant
---

import { CodeBlock, LinkOut } from '@interledger/docs-design-system'
import { Tabs, TabItem } from '@astrojs/starlight/components'
import ChunkedSnippet from '/src/components/ChunkedSnippet.astro'
import Ts from '/src/partials/ts-prerequisites.mdx'

This guide describes how to create an interactive grant. An interactive grant requires interaction from a user, typically your client’s end-user, before the grant can be issued.

For outgoing payment grants, the resource owner (e.g., your client's end-user) must explicitly consent to the creation of an outgoing payment resource. As such, Open Payments requires outgoing payment grants be interactive.

Grants for creating incoming payment and quote resources are non-interactive by default; however, you can choose to make one or both interactive to fit your implementation needs.

## Dependencies

- <LinkOut href='https://github.com/interledger/open-payments/tree/main/packages/open-payments'>
    Open Payments SDK
  </LinkOut>

:::note[HTTP Message Signatures]
HTTP Message Signatures protect the integrity of Open Payments API requests. The Open Payments SDK includes the <LinkOut href='https://github.com/interledger/open-payments/tree/main/packages/http-signature-utils'>HTTP Signature Utils library</LinkOut>, which provides tools for working with HTTP Message Signatures. Additional information can be found in the [Client keys](/introduction/client-keys) and [HTTP message signatures](/introduction/http-signatures) pages.
:::

## Endpoints

- <LinkOut href='https://openpayments.guide/apis/auth-server/operations/post-request/'>
    Grant Request
  </LinkOut>
- <LinkOut href='https://openpayments.guide/apis/auth-server/operations/post-continue/'>
    Continuation Request
  </LinkOut>

## Create an interactive grant

<Tabs>
<TabItem label='TypeScript'>
<Ts />

#### Get started

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-outgoing-payment.ts'
  chunk='1'
/>

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-outgoing-payment.ts'
  chunk='2'
/>

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-outgoing-payment.ts'
  chunk='3'
/>

#### Request an interactive grant

Indicate your client is capable of directing the end-user to a URI to start an interaction. We’ll use an outgoing payment grant as an example.

1. Add the `interact` object to your grant request.
2. Specify `redirect` as the `start` mode. Open Payments only supports `redirect`. The redirect URI will be provided by the authorization server in its response.

Now, indicate your client can receive a signal from the authorization server when the interaction has finished.

1. Add the `finish` object within the `interact` object.
2. Specify `redirect` as the `method`. Open Payments only supports `redirect`.
3. Specify the `uri` that the authorization server will send the end-user back to when the interaction has finished.
4. Create a `nonce` for your client to use to verify the authorization server is the same entity throughout the entire process. The nonce can be any random, hard-to-guess string.

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-outgoing-payment.ts'
  chunk='4'
/>

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-outgoing-payment.ts'
  chunk='5'
/>

#### Start interaction with the end user

Once your client receives the authorization server’s response, it must send the end-user to the `interact redirect` URI contained in the response. This starts the interaction flow.

:::note
Open Payments only supports the `redirect` method. The means by which your client activates the URI is out of scope, but common redirect methods include HTTP redirect and launching a browser on the end-user’s device.
:::

#### Finish interaction with the end user

The end-user interacts with the authorization server through the server’s interface and approves or denies the grant.

Provided the end-user approves the grant, the authorization server:

- Sends the end-user to your client’s previously defined `finish.uri`. The means by which the server sends the end-user to the URI is out of scope, but common options include redirecting the end-user from a web page and launching the system browser with the target URI.
- Secures the redirect by adding a unique hash, allowing your client to validate the `finish` call, and an interaction reference as query parameters to the URI.

#### Request a grant continuation

Add the authorization server’s interaction reference, as the `interact_ref` value, to the body of your continuation request.

<ChunkedSnippet
  source='https://raw.githubusercontent.com/interledger/open-payments-snippets/main/grant/grant-continuation.ts'
  chunk='3'
/>

Issue the request to the `continue uri` supplied in the authorization server’s initial grant response. For example:

`POST https://auth.rafiki.money/continue/49fb4a97-f880-449c-b0e9-d3ac1c947b10`

A successful continuation response from the authorization server provides your client with an access token and other information necessary to continue the transaction.

</TabItem>
</Tabs>

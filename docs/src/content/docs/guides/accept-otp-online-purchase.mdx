---
title: Accept a one-time payment for an online purchase
---

import { LinkOut } from '@interledger/docs-design-system'
import { Tabs, TabItem, Badge } from '@astrojs/starlight/components'
import Start from '/src/partials/grant-start-interaction.mdx'
import Finish from '/src/partials/grant-finish-interaction.mdx'

:::tip[Summary]
Learn how to accept a one-time payment of an agreed-upon amount.
:::

In a business-to-consumer (B2C) model, businesses sell their products directly to consumers, bypassing any intermediaries. This model is also referred to as direct-to-consumer (D2C).

Online retailers often employ the B2C model, allowing customers to pay directly for goods and services. In cases where an intermediary or third-party is owed a portion of the sale, the [payment can be split](/guides/split-payments).

## Scenario

For this guide, you'll assume the role of a developer working for an online athletics company. A customer adds a pair of shoes to their shopping cart and begins the checkout process. Their total is $1,400 MXN. This guide explains how you can implement Open Payments on the retailer's site so that the retailer receives the full amount of the customer's payment.

The parties involved in the transaction are the:

- **Retailer:** the athletics company
- **Developer:** you, as the developer working on the client app
- **Client app:** The retailer's website
- **Customer:** the individual using the retailer's website to make a purchase

## Endpoints

- <Badge text="GET" variant="note" /> <LinkOut href='https://openpayments.dev/apis/wallet-address-server/operations/get-wallet-address/'>Get Wallet Address</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/auth-server/operations/post-request/'>Grant Request</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/resource-server/operations/create-incoming-payment/'>Create an Incoming Payment</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/resource-server/operations/create-quote/'>Create a Quote</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/auth-server/operations/post-continue/'>Grant Continuation Request</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/resource-server/operations/create-outgoing-payment/'>Create an Outgoing Payment</LinkOut>

## Steps

### 1. Get wallet address information

When the customer initiates the payment, the client app (the retailer's site) must get wallet address information for both the customer and themselves.

Let's assume the customer entered their wallet address into the site's checkout form. Let's also assume that the retailer's wallet address is coded into the checkout form.

Call the <Badge text="GET" variant="note" /> [Get Wallet Address API](/apis/wallet-address-server/operations/get-wallet-address) for each address.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerWalletAddress = await client.walletAddress.get({
    url: 'https://cloudninebank.example.com/customer'
  })
  const retailerWalletAddress = await client.walletAddress.get({
    url: 'https://happylifebank.example.com/retailer'
  })
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  let sender_wallet_address = client.wallet_address().get("https://cloudninebank.example.com/customer").await?;
  let retailer_wallet_address = client.wallet_address().get("https://happylifebank.example.com/retailer").await?;
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
The following is an example response from the customer's wallet provider. A similar response will be returned from the retailer's wallet provider.
```json wrap
{
  "id": "https://cloudninebank.example.com/customer",
  "assetCode": "USD",
  "assetScale": 2,
  "authServer": "https://auth.cloudninebank.example.com/",
  "resourceServer": "https://cloudninebank.example.com/op"
}
```
</details>

### 2. Request an incoming payment grant

Use the retailer's `authServer` details, received in the previous step, to call the <Badge text="POST" variant="success" /> [Grant Request API](/apis/auth-server/operations/post-request/).

This call obtains an access token that allows the client app to request an incoming payment resource be created on the retailer's wallet account.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const retailerIncomingPaymentGrant = await client.grant.request(
    {
      url: retailerWalletAddress.authServer
    },
    {
      access_token: {
        access: [
          {
            type: 'incoming-payment',
            actions: ['create'],
          },
        ],
      },
    },
  );
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  use open_payments::types::{AccessTokenRequest, AccessItem, IncomingPaymentAction, GrantRequest};

let incoming_access = AccessTokenRequest {
access: vec![AccessItem::IncomingPayment { actions: vec![IncomingPaymentAction::Create], identifier: None }],
};
let incoming_grant_request = GrantRequest::new(incoming_access, None);

let retailer_incoming_payment_grant = client
.grant()
.request(&retailer_wallet_address.auth_server, &incoming_grant_request)
.await?;

````
</TabItem>
</Tabs>

<details>
<summary>Example response</summary>
The following is an example response from the retailer's wallet provider.
```json wrap
{
"access_token": {
  "value": "...", // access token value for incoming payment grant
  "manage": "https://auth.happylifebank.example.com/token/{...}", // management uri for access token
  "access": [
    {
      "type": "incoming-payment",
      "actions": ["create"]
    }
  ]
},
"continue": {
  "access_token": {
    "value": "..." // access token for continuing the request
  },
  "uri": "https://auth.happylifebank.example.com/continue/{...}" // continuation request uri
}
}
````

</details>

### 3. Request the creation of an incoming payment resource

Use the access token returned in the previous response to call the <Badge text="POST" variant="success" /> [Create an Incoming Payment API](/apis/resource-server/operations/create-incoming-payment).

This call requests an incoming payment resource be created on the retailer's wallet account.

Remember that the full amount of the customer's purchase is $1,400 MXN.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const retailerIncomingPayment = await.client.incomingPayment.create(
    {
      url: retailerWalletAddress.resourceServer,
      accessToken: retailerIncomingPaymentGrant.access_token.value
    },
    {
      walletAddress: retailerWalletAddress.id,
      incomingAmount: {
        value: '140000',
        assetCode: 'MXN',
        assetScale: 2
      },
    },
  )
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  use open_payments::types::{IncomingPaymentRequest, Amount};

let incoming_request = IncomingPaymentRequest {
wallet_address: retailer_wallet_address.id.clone(),
incoming_amount: Some(Amount { value: "140000".into(), asset_code: "MXN".into(), asset_scale: 2 }),
expires_at: None,
metadata: None,
};

let retailer_incoming_payment = client
.incoming_payments()
.create(
&retailer_wallet_address.resource_server,
&incoming_request,
Some(&retailer_incoming_payment_grant.access_token.value),
)
.await?;

````
</TabItem>
</Tabs>

<details>
<summary>Example response</summary>
The following is an example response from the retailer's wallet provider.
```json wrap
{
"id": "https://happylifebank.example.com/incoming-payments/{...}",
"walletAddress": "https://happylifebank.example.com/retailer",
"incomingAmount": {
  "value": "140000",
  "assetCode": "MXN",
  "assetScale": 2
},
"receivedAmount": {
  "value": "0",
  "assetCode": "MXN",
  "assetScale": 2
},
"completed": false,
"createdAt": "2025-03-12T23:20:50.52Z",
"methods": [
  {
    "type": "ilp",
    "ilpAddress": "...",
    "sharedSecret": "..."
  }
]
}
````

</details>

### 4. Request a quote grant

Use the customer's `authServer` details, returned in Step 1, to call the <Badge text="POST" variant="success" /> [Grant Request API](/apis/auth-server/operations/post-request/).

This call obtains an access token that allows the client app to request a quote resource be created on the customer's wallet account.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerQuoteGrant = await client.grant.request(
    {
      url: customerWalletAddress.authServer
    },
    {
      access_token: {
        access: [
          {
            type: 'quote',
            actions: ['create']
          }
        ]
      }
    }
  )
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  use open_payments::types::{AccessTokenRequest, AccessItem, QuoteAction, GrantRequest};

let quote_access = AccessTokenRequest {
access: vec![AccessItem::Quote { actions: vec![QuoteAction::Create] }],
};
let quote_grant_request = GrantRequest::new(quote_access, None);
let customer_quote_grant = client
.grant()
.request(&customer_wallet_address.auth_server, &quote_grant_request)
.await?;

````
</TabItem>
</Tabs>

<details>
<summary>Example response</summary>
The following is an example response from the customer's wallet provider.
```json wrap
{
"access_token": {
  "value": "...", // access token value for quote grant
  "manage": "https:/auth.cloudninebank.example.com/token/{...}", // management uri for access token
  "access": [
    {
      "type": "quote",
      "actions": ["create"]
    }
  ]
},
"continue": {
  "access_token": {
    "value": "..." // access token for continuing the request
  },
"uri": "https://auth.cloudninebank.example.com/continue/{...}" // continuation request uri
}
}
````

</details>

### 5. Request the creation of a quote resource

Use the access token received in the previous step to call the <Badge text="POST" variant="success" /> [Create Quote API](/apis/resource-server/operations/create-quote/).

This call requests a quote resource be created on the customer's wallet account.

The request must contain the receiver, which is the `id` of the incoming payment. The `id` was returned in the Create an Incoming Payment API response in Step 3.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerQuote = await client.quote.create(
    {
      url: customerWalletAddress.resourceServer,
      accessToken: customerQuoteGrant.access_token.value
    },
    {
      method: 'ilp',
      walletAddress: customerWalletAddress.id,
      receiver: retailerIncomingPayment.id
    }
  )
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  use open_payments::types::{QuoteRequest, QuoteMethod};

let quote_request = QuoteRequest {
method: QuoteMethod::Ilp,
wallet_address: Some(customer_wallet_address.id.clone()),
receiver: Some(retailer_incoming_payment.id.clone()),
debit_amount: None,
receive_amount: None,
};

let customer_quote = client
.quotes()
.create(
&customer_wallet_address.resource_server,
&quote_request,
Some(&customer_quote_grant.access_token.value),
)
.await?;

````
</TabItem>
</Tabs>

The response returns a `receiveAmount`, a `debitAmount`, and other required information.

- `debitAmount` - The amount (in MXN) that will be charged to the customer
- `receiveAmount` - The `incomingAmount` value from the incoming payment resource

<details>
<summary>Example response</summary>
The following is an example response from the customer's wallet provider.
```json wrap
{
"id": "https://cloudninebank.example.com/quotes/{...}", // url identifying the quote
"walletAddress": "https://cloudninebank.example.com/customer",
"receiver": "https://happylifebank.example.com/incoming-payments/{...}", // url of the incoming payment the quote is created for
"debitAmount": {
  "value": "140000",
  "assetCode": "MXN",
  "assetScale": 2
},
"receiveAmount": {
  "value": "140000",
  "assetCode": "MXN",
  "assetScale": 2
},
"method": "ilp",
"createdAt": "2025-03-12T23:22:51.50Z"
}
````

</details>

### 6. Request an interactive outgoing payment grant

Use the customer's `authServer` information to call the <Badge text="POST" variant="success" /> [Grant Request API](/apis/auth-server/operations/post-request).

This call obtains an access token that allows the client app to request outgoing payment resources be created on the customer's wallet account. For this guide, the request will be limited up to the amount of `140000` (\$1400.00)

:::note
Outgoing payments require an interactive grant. This type of grant will obtain the customer's consent before an outgoing payment is made against their wallet account. You can find more information in the [Open Payments flow](/concepts/op-flow/#outgoing-payment) and [identity providers](/identity/idp) pages.
:::

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const pendingCustomerOutgoingPaymentGrant = await client.grant.request(
    {
      url: customerWalletAddress.authServer
    },
    {
      access_token: {
        access: [
          {
            identifier: customerWalletAddress.id,
            type: 'outgoing-payment',
            actions: ['create'],
            limits: {
              debitAmount: {
                assetCode: 'MXN',
                assetScale: 2,
                value: '140000',
              }
            }
          }
        ]
      },
      interact: {
        start: ['redirect'],
        finish: {
          method: 'redirect',
          uri: 'https://paymentplatform.example/finish/{...}', // where to redirect the customer after they've completed the interaction
          nonce: NONCE
        }
      }
    }
  )
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  use open_payments::types::{AccessTokenRequest, AccessItem, OutgoingPaymentAction, InteractRequest, InteractStart, InteractFinish, InteractFinishMethod, AccessLimits, Amount, GrantRequest};
  
  let access_limits = AccessLimits {
    debit_amount: Some(Amount { value: "140000".into(), asset_code: "MXN".into(), asset_scale: 2 }),
    ..Default::default()
  };
  let access_request = AccessTokenRequest {
    access: vec![AccessItem::OutgoingPayment {
      identifier: Some(customer_wallet_address.id.clone()),
      actions: vec![OutgoingPaymentAction::Create],
      limits: Some(access_limits),
    }],
  };
  let interact_request = InteractRequest {
    start: Some(vec![InteractStart::Redirect]),
    finish: Some(InteractFinish {
      method: InteractFinishMethod::Redirect,
      uri: Some("https://paymentplatform.example/finish/{...}".into()),
      nonce: Some("NONCE".into()),
    }),
  };
  
  let grant_request = GrantRequest::new(access_request, Some(interact_request));
  let pending_customer_outgoing_payment_grant = client
    .grant()
    .request(&customer_wallet_address.auth_server, &grant_request)
    .await?;
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
The following is an example response from the customer's wallet provider.
```json wrap
{
  "interact": {
    "redirect": "https://auth.interledger-test.dev/{...}", // uri to redirect the customer to, to begin interaction
    "finish": "..." // unique key to secure the callback
  },
  "continue": {
    "access_token": {
      "value": "..." // access token for continuing the outgoing payment grant request
    },
    "uri": "https://auth.interledger-test.dev/continue/{...}", // uri for continuing the outgoing payment grant request
    "wait": 30
  }
}
```
</details>

### 7. Start interaction with the customer

<Start />

### 8. Finish interaction with the customer

<Finish />

### 9. Request a grant continuation

In our example, we're assuming the IdP the customer interacted with has a user interface. When the interaction completes, the customer returns to the client app. Now the app can make a continuation request for the outgoing payment grant.

:::note
In a scenario where a user interface isn't available, consider implementing a polling mechanism to check for the completion of the interaction.
:::

Call the <Badge text="POST" variant="success" /> [Grant Continuation Request API](/apis/auth-server/operations/post-continue/). This call requests an access token that allows the client app to request an outgoing payment resource be created on the customer's wallet account.

Issue the request to the `continue.uri` provided in the initial outgoing payment grant response (Step 6).

Include the `interact_ref` returned in the redirect URI's query parameters.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerOutgoingPaymentGrant = await client.grant.continue(
    {
      url: pendingCustomerOutgoingPaymentGrant.continue.uri,
      accessToken: pendingCustomerOutgoingPaymentGrant.continue.access_token.value
    },
    {
      interact_ref: interactRef
    }
  )
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  let continue_field = match &pending_customer_outgoing_payment_grant.continue_field {
    Some(c) => c,
    None => {
      eprintln!("Missing continue field on pending grant");
      return Ok(());
    }
  };

let customer_outgoing_payment_grant = client
.grant()
.continue_grant(
&continue_field.uri,
&interact_ref,
Some(&continue_field.access_token.value),
)
.await?;

````
</TabItem>
</Tabs>

<details>
<summary>Example response</summary>
The following is an example response from the customer's wallet provider.
```json wrap
{
"access_token": {
  "value": "...", // final access token required before creating outgoing payments
  "manage": "https://auth.cloudninebank.example.com/token/{...}", // management uri for access token
  "access": [
    {
      "type": "outgoing-payment",
      "actions": ["create"],
      "identifier": "https://cloudninebank.example.com/customer",
      "limits": {
        "receiver": "https://happylifebank.example.com/incoming-payments/{...}" // url of the incoming payment that's being paid
      }
    }
  ]
},
"continue": {
"access_token": {
"value": "..." // access token for continuing the request
},
"uri": "https://auth.cloudninebank.example.com/continue/{...}" // continuation request uri
}
}
````

</details>

### 10. Request the creation of an outgoing payment resource

Use the access token returned in Step 9 to call the <Badge text="POST" variant="success" /> [Create Outgoing Payment API](/apis/resource-server/operations/create-outgoing-payment/). This call requests the creation of an outgoing payment resource be created on the customer's wallet account. Include the `quoteId` in the request. The `quoteId` is the `id` returned in the Create Quote API response (Step 5).

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerOutgoingPayment = await client.outgoingPayment.create(
    {
      url: customerWalletAddress.resourceServer,
      accessToken: customerOutgoingPaymentGrant.access_token.value
    },
    {
      walletAddress: customerWalletAddress.id,
      quoteId: customerQuote.id
    }
  )
  ```
  </TabItem>
  <TabItem label='Rust' icon='seti:rust'>
  ```rust wrap
  use open_payments::types::OutgoingPaymentRequest;
  let outgoing_request = OutgoingPaymentRequest {
    wallet_address: customer_wallet_address.id.clone(),
    receiver: Some(retailer_incoming_payment.id.clone()),
    debit_amount: None,
    receive_amount: None,
    quote_id: Some(customer_quote.id.clone()),
  };
  let customer_outgoing_payment_to_retailer = client
    .outgoing_payments()
    .create(
      &customer_wallet_address.resource_server,
      &outgoing_request,
      Some(&customer_outgoing_payment_grant.access_token.value),
    )
    .await?;
  ```
  </TabItem>
</Tabs>

If the request fails because of an expired quote, [request a new quote](#5-request-the-creation-of-a-quote-resource) and try again.

<details>
<summary>Example response</summary>
The following is an example response from the customer's wallet provider.
```json wrap
{
  "id": "https://cloudninebank.example.com/outgoing-payments/{...}", // url identifying the outgoing payment
  "walletAddress": "https://cloudninebank.example.com/customer",
  "receiver": "https://happylifebank.example.com/incoming-payments/{...}", // url of the incoming payment being paid
  "debitAmount": {
    "value": "140000",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "receiveAmount": {
    "value": "140000",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "sentAmount": {
    "value": "0",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "createdAt": "2022-03-12T23:20:54.52Z"
}
```
</details>

:::note[Access token expiry]
If a grant's access token has expired, call the <Badge text="POST" variant="success" /> [Rotate Access Token API](/apis/auth-server/operations/post-token/), then use the new token in the appropriate request.
:::

---
title: Accept a one-time payment for an online purchase
---

import { LinkOut } from '@interledger/docs-design-system'
import { Tabs, TabItem, Badge } from '@astrojs/starlight/components'
import InteractionReq from '/src/partials/interaction-required.mdx'
import Start from '/src/partials/grant-start-interaction.mdx'
import Finish from '/src/partials/grant-finish-interaction.mdx'

:::tip[Summary]
Learn how to accept a one-time payment of an agreed-upon amount.
:::

In a business-to-consumer (B2C) model, businesses sell their products directly to consumers, bypassing any intermediaries. This model is also referred to as direct-to-consumer (D2C).

Online retailers often employ the B2C model, allowing customers to pay directly for goods and services. In cases where an intermediary or third-party is owed a portion of the sale, the [payment can be split](/guides/split-payment).

Remember, Open Payments doesn't execute payments or touch money in any way. It's used to issue payment instructions before any money movement occurs. A simplified example of a payment instruction is, “debit MXN $500 from my account”.

## Scenario

For this guide, you'll assume the role of a developer working for an online athletics company. A customer adds a pair of shoes to their shopping cart and begins the checkout process. Their total is MXN $1,400. This guide explains how you can implement Open Payments on the retailer's site so that the retailer receives the full amount of the customer's payment.

The three parties involved in the transaction are the:

- Developer: you, as the developer working on the client (the retailer's website)
- Customer: the individual using the retailer's website to make a purchase
- Retailer: the athletics company

## Endpoints

- <Badge text="GET" variant="note" /> <LinkOut href='https://openpayments.dev/apis/wallet-address-server/operations/get-wallet-address/'>Get Wallet Address</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/auth-server/operations/post-request/'>Grant Request</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/resource-server/operations/create-incoming-payment/'>Create an Incoming Payment</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/resource-server/operations/create-quote/'>Create a Quote</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/auth-server/operations/post-continue/'>Grant Continuation Request</LinkOut>
- <Badge text="POST" variant="success" /> <LinkOut href='https://openpayments.dev/apis/resource-server/operations/create-outgoing-payment/'>Create an Outgoing Payment</LinkOut>

## Steps

### 1. Get wallet address information

When the customer initiates the payment, the retailer's site--the client--must get wallet address information for both the customer and themselves.

Let's assume the customer entered their wallet address at the beginning of the checkout flow. Let's also assume that the retailer's wallet address is built into the client in some way.

Call the <Badge text="GET" variant="note" /> [Get Wallet Address API](/apis/wallet-address-server/operations/get-wallet-address) for each address.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerWalletAddress = await client.walletAddress.get({
  url: 'https://cloudninebank.example.com/customer'
  })
  const retailerWalletAddress = await client.walletAddress.get({
  url: 'https://happylifebank.example.com/retailer'
  })
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
The following shows an example response from the customer's wallet provider. A similar response will be returned from the retailer's wallet provider.
```json wrap
{
  "id": "https://cloudninebank.example.com/customer",
  "assetCode": "USD",
  "assetScale": 2,
  "authServer": "https://auth.cloudninebank.example.com/",
  "resourceServer": "https://cloudninebank.example.com/op"
}
```
</details>

### 2. Request an incoming payment grant

Use the retailer's `authServer` details, received in the previous step, to call the <Badge text="POST" variant="success" /> [Grant Request API](/apis/auth-server/operations/post-request/).

This call obtains an access token that allows the client to request an incoming payment resource be created on the retailer's wallet account.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const retailerIncomingPaymentGrant = await client.grant.request(
    {
      url: retailerWalletAddress.authServer
    },
    {
      access_token: {
        access: [
          {
            type: 'incoming-payment',
            actions: ['read', 'create'],
          },
        ],
      },
    },
  );
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
```json wrap
{
  "access_token": {
    "value": "...", // access token value for incoming payment grant
    "manage": "https://happylifebank.example.com/token/{...}", // management uri for access token
    "access": [
      {
        "type": "incoming-payment",
        "actions": ["create", "read"]
      }
    ]
  },
  "continue": {
    "access_token": {
      "value": "..." // access token for continuing the request
    },
    "uri": "https://happylifebank.example.com/continue/{...}" // continuation request uri
  }
}
```
</details>

### 3. Request the creation of an incoming payment resource

Use the access token returned in the previous response to call the <Badge text="POST" variant="success" /> [Create an Incoming Payment API](/apis/resource-server/operations/create-incoming-payment).

This call requests an incoming payment resource be created on the retailer's wallet account.

Remember that the full amount of the customer's purchase is MXN $1,400.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const retailerIncomingPayment = await.client.incomingPayment.create(
    {
      url: retailerWalletAddress.resourceServer,
      accessToken: retailerIncomingPaymentGrant.access_token.value
    },
    {
      walletAddress: retailerWalletAddress.id,
      incomingAmount: {
        value: '140000',
        assetCode: 'MXN',
        assetScale: 2
      },
    },
  )
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
```json wrap
{
  "id": "https://happylifebank.example.com/incoming-payments/{...}",
  "walletAddress": "https://happylifebank.example.com/retailer",
  "incomingAmount": {
    "value": "140000",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "receivedAmount": {
    "value": "0",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "completed": false,
  "createdAt": "2025-03-12T23:20:50.52Z",
  "methods": [
    {
      "type": "ilp",
      "ilpAddress": "...",
      "sharedSecret": "..."
    }
  ]
}
```
</details>

### 4. Request a quote grant

Use the customer's `authServer` details, returned in Step 1, to call the <Badge text="POST" variant="success" /> [Grant Request API](/apis/auth-server/operations/post-request/).

This call obtains an access token that allows your client to request a quote resource be created on the customer's wallet account.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerQuoteGrant = await client.grant.request(
    {
      url: customerWalletAddress.authServer
    },
    {
      access_token: {
        access: [
          {
            type: 'quote',
            actions: ['create', 'read']
          }
        ]
      }
    }
  )
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
```json wrap
{
  "access_token": {
    "value": "...", // access token value for quote grant
    "manage": "https:/cloudninebank.example.com/token/{...}", // management uri for access token
    "access": [
      {
        "type": "quote",
        "actions": ["create", "read"]
      }
    ]
  },
  "continue": {
    "access_token": {
      "value": "..." // access token for continuing the request
    },
  "uri": "https://auth.cloudninebank.example.com/continue/{...}" // continuation request uri
  }
}
```
</details>

### 5. Request the creation of a quote resource

Use the access token received in the previous step to call the <Badge text="POST" variant="success" /> [Create Quote API](/apis/resource-server/operations/create-quote/).

This call requests a quote resource be created on the customer's wallet account.

The request must contain the receiver, which is the `id` of the incoming payment. The `id` was returned in the Create an Incoming Payment API response in Step 3.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerQuote = await client.quote.create(
    {
      url: customerWalletAddress.resourceServer,
      accessToken: customerQuoteGrant.access_token.value
    },
    {
      method: 'ilp',
      walletAddress: customerWalletAddress.id,
      receiver: retailerIncomingPayment.id
    }
  )
  ```
  </TabItem>
</Tabs>

The response returns a `receiveAmount`, a `debitAmount`, and other required information.

- `debitAmount` - The total amount the customer will pay into the retailer's incoming payment resource
- `receiveAmount` - The `incomingAmount` value from the incoming payment resource

<details>
<summary>Example response</summary>
```json wrap
{
  "id": "https://cloudninebank.example.com/quotes/{...}", // url identifying the quote
  "walletAddress": "https://cloudninebank.example.com/customer",
  "receiver": "https://happylifebank.example.com/incoming-payments/{...}", // url of the incoming payment the quote is created for
  "debitAmount": {
    "value": "140000",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "receiveAmount": {
    "value": "140000",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "method": "ilp",
  "createdAt": "2025-03-12T23:22:51.50Z"
}
```
</details>

### 6. Request an interactive outgoing payment grant

Use the customer's `authServer` information to call the <Badge text="POST" variant="success" /> [Grant Request API](/apis/auth-server/operations/post-request).

This call obtains an access token that allows your client to request outgoing payment resources be created on the customer's wallet account.

<InteractionReq />

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const pendingCustomerOutgoingPaymentGrant = await client.grant.request(
    {
      url: customerWalletAddress.authServer
    },
    {
      access_token: {
        access: [
          {
            identifier: customerWalletAddress.id,
            type: 'outgoing-payment',
            actions: ['read', 'create'],
            limits: {
              debitAmount: {
                assetCode: 'MXN',
                assetScale: 2,
                value: 140000,
              }
            }
          }
        ]
      },
      interact: {
        start: ['redirect'],
        finish: {
          method: 'redirect',
          uri: 'https://paymentplatform.example/finish/{...}', // where to redirect the customer after they've completed interaction
          nonce: NONCE
        }
      }
    }
  )
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
```json wrap
{
  "interact": {
    "redirect": "https://auth.interledger-test.dev/{...}", // uri to redirect the customer to, to begin interaction
    "finish": "..." // unique key to secure the callback
  },
  "continue": {
    "access_token": {
      "value": "..." // access token for continuing the outgoing payment grant request
    },
    "uri": "https://auth.interledger-test.dev/continue/{...}", // uri for continuing the outgoing payment grant request
    "wait": 30
  }
}
```
</details>

### 7. Start interaction with the customer

<Start />

### 8. Finish interaction with the customer

<Finish />

### 9. Request a grant continuation

In our example, we're assuming the IdP the customer interacted with has a user interface. When the interaction completes, the customer returns to your client. Now your client can make a continuation request for the outgoing payment grant.

:::note
In a scenario where a user interface isn't available, consider implementing a polling mechanism to check for the completion of the interaction.
:::

Call the <Badge text="POST" variant="success" /> [Grant Continuation Request API](/apis/auth-server/operations/post-continue/). This call requests an access token that allows your client to request an outgoing payment resource be created on the customer's wallet account.

Issue the request to the `continue.uri` provided in the initial outgoing payment grant response (Step 6).

Include the `interact_ref` returned in the redirect URI's query parameters.

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerOutgoingPaymentGrant = await client.grant.continue(
    {
      url: pendingCustomerOutgoingPaymentGrant.continue.uri,
      accessToken: pendingCustomerOutgoingPaymentGrant.continue.access_token.value
    },
    {
      interact_ref: interactRef
    }
  )
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
```json wrap
{
  "access_token": {
    "value": "...", // final access token required before creating outgoing payments
    "manage": "https://auth.cloudninebank.example.com/token/{...}", // management uri for access token
    "access": [
      {
        "type": "outgoing-payment",
        "actions": ["create", "read"],
        "identifier": "https://cloudninebank.example.com/customer",
        "limits": {
          "receiver": "https://happylifebank.example.com/incoming-payments/{...}" // url of the incoming payment that's being paid
        }
      }
    ]
  },
  "continue": {
  "access_token": {
  "value": "..." // access token for continuing the request
  },
  "uri": "https://auth.cloudninebank.example.com/continue/{...}" // continuation request uri
  }
}
```
</details>

### 10. Request the creation of an outgoing payment resource

Recall that the Create Quote API response for the retailer (Step 5) included a `debitAmount` and a `receiveAmount`. The response also included an `id`, which is a URL to identify the quote.

Since there's already a debit amount, receive amount, and a quote ID, there's no need to specify any other amounts in the outgoing payment request.

Use the access token returned in Step 5 to call the <Badge text="POST" variant="success" /> [Create Outgoing Payment API](/apis/resource-server/operations/create-outgoing-payment/).

<Tabs syncKey="lang">
  <TabItem label='TypeScript/JavaScript' icon='seti:javascript'>
  ```ts wrap
  const customerOutgoingPayment = await client.outgoingPayment.create(
    {
      url: customerWalletAddress.resourceServer,
      accessToken: customerOutgoingPaymentGrant.access_token.value
    },
    {
      walletAddress: customerWalletAddress.id,
      quoteId: retailerQuote.id
    }
  )
  ```
  </TabItem>
</Tabs>

<details>
<summary>Example response</summary>
```json wrap
{
  "id": "https://cloudninebank.example.com/outgoing-payments/{...}", // url identifying the outgoing payment
  "walletAddress": "https://cloudninebank.example.com/customer",
  "receiver": "https://happylifebank.example.com/incoming-payments/{...}", // url of the incoming payment being paid
  "debitAmount": {
    "value": "140000",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "receiveAmount": {
    "value": "140000",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "sentAmount": {
    "value": "0",
    "assetCode": "MXN",
    "assetScale": 2
  },
  "createdAt": "2022-03-12T23:20:54.52Z"
}
```
</details>
